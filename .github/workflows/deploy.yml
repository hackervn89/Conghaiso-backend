name: Deploy Backend to Server

on:
  # KÃ­ch hoáº¡t khi cÃ³ code Ä‘Æ°á»£c Ä‘áº©y lÃªn nhÃ¡nh main
  push:
    branches:
      - main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: Deploy to Server via SSH
        uses: appleboy/ssh-action@master
        with:
          host: ${{ secrets.SERVER_HOST }}
          username: ${{ secrets.SERVER_USER }}
          key: ${{ secrets.SERVER_SSH_PRIVATE_KEY }}
          script: |
            echo "ðŸš€ Báº¯t Ä‘áº§u triá»ƒn khai Backend..."
            cd /home/hoangvietadmin/conghaiso/conghaiso-backend
            
            echo "ðŸ”„ KÃ©o code má»›i nháº¥t tá»« nhÃ¡nh main..."
            git fetch --all
            git reset --hard origin/main

            echo "ðŸ“¦ CÃ i Ä‘áº·t cÃ¡c thÆ° viá»‡n cáº§n thiáº¿t..."
            npm install --production

            echo "ðŸ”„ Khá»Ÿi Ä‘á»™ng láº¡i á»©ng dá»¥ng backend vá»›i PM2..."
            # Sá»­ dá»¥ng 'restart' Ä‘á»ƒ Ä‘áº£m báº£o á»©ng dá»¥ng Ä‘Æ°á»£c lÃ m má»›i hoÃ n toÃ n
            pm2 restart conghaiso-api
            
            echo "âœ… Triá»ƒn khai Backend thÃ nh cÃ´ng!"